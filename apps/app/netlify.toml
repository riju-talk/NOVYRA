[build]
  # Root-level script already runs: cd apps/app && npm run build
  command = "npm run build"
  # Publish path must be relative to the repository root (config file is in a subfolder)
  publish = "apps/app/.next"

[functions]
  directory = "netlify/functions"
  node_bundler = "esbuild"

[[plugins]]
  package = "@netlify/plugin-nextjs"

[[redirects]]
  from = "/api/ai-agent/*"
  to = "/.netlify/functions/proxy-ai-agent/:splat"
  status = 200
  force = true

[build.environment]
  # Disable Netlify secrets scanning (prevents failures on detected strings in repo/build)
  SECRETS_SCAN_ENABLED = "false"
  # Or, instead of disabling entirely, omit known safe keys/paths (uncomment if preferred)
  # SECRETS_SCAN_OMIT_KEYS = "NEXTAUTH_URL,NEXT_PUBLIC_SPARK_API_URL,GROQ_MODEL"
  # SECRETS_SCAN_OMIT_PATHS = "README.md,ALPHA-REPORT.md,apps/ai-agent/**,docker-compose.yml"

  # Optional: skip contacting AI agent during build if your code checks this flag
  SKIP_AI_AGENT_HEALTH_CHECK = "true"