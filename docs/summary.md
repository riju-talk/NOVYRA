# NOVYRA — System Summary

## What It Is

NOVYRA is a production-grade adaptive AI learning infrastructure. It is not a chatbot — it is an explainable, graph-driven reasoning engine with deterministic scoring, mastery tracking, and multilingual support.

---

## System Architecture

```
apps/
  app/           → Next.js 14 frontend (community, gamification, Q&A)
  ai-agent/      → FastAPI AI Engine (port 8000)
    core/        → config, Gemini LLM client (no LangChain), prompts
    schemas/     → Pydantic I/O contracts
    services/    → 5 reasoning engines
    api/routes/  → HTTP endpoints
infrastructure/
  docker-compose.yml  → Neo4j + AI Engine + Frontend
apps/app/prisma/
  schema.prisma       → PostgreSQL schema (community + AI engine models)
```

---

## AI Engines

### Knowledge Graph (Neo4j)
- Concept nodes with domain, difficulty, prereqs
- `PREREQUISITE_OF` and `MASTERED_BY` relationships
- Shortest-path learning recommendations
- Weak node detection per user

### Structured Reasoning Engine
- Input: student question (any language)
- Output: validated JSON — concept, prerequisites, stepwise breakdown, hint ladder, confidence score, related concepts
- Graph context injected into every prompt
- Zero LangChain — direct `google-generativeai` SDK + tenacity retry

### Rubric-Aware Evaluation Engine
- Weighted criterion scoring (score computed in Python, not by LLM)
- Per-criterion feedback + improvement plan
- Grade labels: Excellent / Good / Satisfactory / Needs Improvement

### Mastery Tracking Engine
- Formula: `mastery = (correct / total) × confidence_weight`
- Confidence weight decays with hint dependency and inactivity (7-day threshold)
- Per-attempt audit log, Neo4j edge updated on every attempt
- Personalised study nudge generated by Gemini when mastery < 40%

### Multilingual Layer
- `langdetect` for language detection
- `deep-translator` (Google backend, no API key) for translation
- Reasoning always performed in English internally
- Supports 20+ languages including all major Indian languages

---

## Stack

| Layer | Technology |
|---|---|
| Frontend | Next.js 14, TypeScript, TailwindCSS, Radix UI |
| Backend | FastAPI, Python 3.12, Pydantic v2 |
| LLM | Google Gemini 1.5 Flash (direct SDK) |
| Knowledge Graph | Neo4j 5.20 Community |
| Relational DB | PostgreSQL via Prisma ORM |
| Translation | deep-translator + langdetect |
| Containers | Docker Compose |

---

## Key API Endpoints

| Endpoint | Engine |
|---|---|
| `POST /api/reasoning/ask` | Structured reasoning |
| `POST /api/evaluation/evaluate` | Rubric evaluation |
| `POST /api/mastery/attempt` | Mastery update |
| `GET  /api/mastery/profile/{user_id}` | Full mastery profile |
| `POST /api/graph/concept` | Add concept node |
| `GET  /api/graph/path/{user_id}/{concept}` | Learning path |
| `GET  /health` | Health + Neo4j connectivity |

---

## Prisma Models Added

- `Concept` — learnable topic
- `ConceptPrerequisite` — prerequisite links
- `ConceptAttempt` — per-attempt audit log
- `MasteryRecord` — latest mastery score per user × concept
- `RubricEvaluation` — stored evaluation results

---

## Environment Variables (minimum required)

```
GOOGLE_API_KEY       # Gemini API key
DATABASE_URL         # PostgreSQL connection string
NEO4J_URI            # bolt://neo4j:7687
NEO4J_PASSWORD       # novyra_neo4j
NEXTAUTH_SECRET      # NextAuth signing secret
```

---

## Quick Start

```bash
cp .env.example .env        # fill in GOOGLE_API_KEY + DATABASE_URL
docker-compose up --build   # starts Neo4j + AI Engine + Frontend
cd apps/app && npx prisma migrate dev --name novyra_init
```

Services: Frontend `:5000` · AI Engine `:8000` · Neo4j Browser `:7474` · API Docs `:8000/docs`
